function setupLayer(table_element_id) {
    var table = document.getElementById(table_element_id);
    table.innerHTML = "";

    for(i=0;i<row_count;i++) {
        var tr = document.createElement('tr');
        for(j=0;j<col_count;j++) {
            var td = document.createElement('td');
            var img = document.createElement('img');
            img.src = "images/blank.png";

            td.appendChild(img);
            tr.appendChild(td);
        }

        table.appendChild(tr);
    }
}


function startLvl() {
    // Make sure all timers are off
    for(var i=0;i<bulldozers.length;i++) {
        bulldozers[i].destroy();
    }
    for(var i=0;i<humans.length;i++) {
        humans[i].destroy();
    }
    for(var j=0;j<rocks.length;j++) {
        rocks[j].intact = false;
    }
    rocks = [];

    if(bombTimer)
        clearTimeout(bombTimer);
    bombTimer = false;
    if(loseFlag)
        clearTimeout(loseFlag);
    loseFlag = false;
    if(winFlag)
        clearTimeout(winFlag);
    winFlag = false;

    current_page = new Location(0, 0);
	page_count_x = 1;
	page_count_y = 1;

    level_init_functions[parseInt(level) - 1]();

    city_tiles = [];
    for(var i=0;i<tileStat.length;i++) {
        city_tiles.push([]);
        for(var j=0;j<tileStat[i].length;j++) {
            city_tiles[i].push(tileStat[i][j] == 4);
        }
    }

    setupLayer("game_table");
    setupLayer("overlay1");
    setupLayer("overlay2");

    setTimeout(function() {
        // This loop sets up the table written in HTML above, and adds initial pictures to it.
        processAllTiles();
        for(var i=0;i<bulldozers.length;i++) {
            bulldozers[i].start();
        }
        for(var i=0;i<humans.length;i++) {
            humans[i].start();
        }
        pools = [];
        for(var i=0;i<row_count;i++) {
            for(var j=0;j<col_count;j++) {
                if(nodes[i][j] == "1111") {
                    pools.push(new Location(j, i));
                }
            }
        }
        controls_active = true;
		for(var x=0;x<page_count_x;x++) {
			for(var y=0;y<page_count_y;y++) {
				if(!current_page.compareTo(new Location(x, y)))
					pausePage(new Location(x, y));
			}
		}
    },0);
}

var level_init_functions = [
    function() {
        // LEVEL 1
        row_count = 14;
        col_count = 20;

        var tiles1 = new Array("1001", "1010", "1100","1001","1010","1010","1010","1000","1000","1100","1001","1000","1000","1010","1010","1010","1100","1001","1010","1100");
        var tiles2 = new Array("0101","1111","0101","0101","1001","1010","1000","0110","0101","0101","0101","0101","0011","1000","1010","1100","0101","0101","1111","0101");
        var tiles3 = new Array("0011","1010","0100","0101","0011","1100","0011","1010","0100","0011","0110","0001","1010","0110","1001","0110","0101","0001","1010","0110");
        var tiles4 = new Array("1001","1100","0011","0000","1000","0100","1001","1100","0001","1100","1001","0100","1001","1100","0001","1000","0000","0110","1001","1100");
        var tiles5 = new Array("0101","0101","1001","0100","0011","0100","0101","0011","0000","0110","0011","0000","0110","0101","0001","0110","0001","1100","0101","0101");
        var tiles6 = new Array("0101","0011","0100","0001","1100","0011","0000","1100","0001","1000","1000","0100","1001","0000","0110","1001","0100","0001","0110","0101");
        var tiles7 = new Array("0001","1100","0101","0001","0110","1111","0001","0110","0001","0000","0000","0100","0011","0100","1111","0011","0100","0101","1001","0100");
        var tiles8 = new Array("0101","0001","0010","0010","1010","1100","0011","1010","0010","0000","0000","0010","1010","0110","1001","1010","0010","0010","0100","0101");
        var tiles9 = new Array("0011","0010","1010","1000","1010","0000","1000","1000","1010","0010","0010","1010","1000","1000","0000","1010","1000","1010","0010","0110");
        var tiles10 = new Array("1001","1010","1010","0100","1001","0100","0011","0100","1001","1000","1000","1100","0001","0110","0001","1100","0001","1010","1010","1100");
        var tiles11 = new Array("0101","1001","1010","0000","0000","0010","1000","0100","0011","0000","0000","0110","0001","1000","0010","0000","0000","1010","1100","0101");
        var tiles12 = new Array("0001","0100","1111","0101","0001","1100","0011","0010","1000","0010","0010","1000","0010","0110","1001","0100","0101","1111","0001","0100");
        var tiles13 = new Array("0101","0011","1010","0110","0001","0010","1010","1000","0000","1000","1000","0000","1000","1010","0010","0100","0011","1010","0110","0101");
        var tiles14 = new Array("0011","1010","1010","1010","0010","1010","1010","0110","0011","0010","0010","0110","0011","1010","1010","0010","1010","1010","1010","0110");
        nodes = [tiles1,tiles2,tiles3,tiles4,tiles5,tiles6,tiles7,tiles8,tiles9,tiles10,tiles11,tiles12,tiles13,tiles14];

        tileStat = new Array();
        for(var i=0;i<row_count;i++) {
            tileStat.push([]);
            for(var j=0;j<col_count;j++) {
                tileStat[i].push(1);
            }
        }

        my_loc = new Location(10, 6)

        bulldozers = [
            new Bulldozer(1400, new Location(19, 3), 3),
            new Bulldozer(1210, new Location(12, 13), 0),
            new Bulldozer(1030, new Location(19, 9), 3)
        ];

    }, function() {
        // LEVEL 2
        row_count = 14;
        col_count = 14;

        var forest1 = new Array("1001", "1010", "1000","1000","1010","1100","1001","1010","1000","1000","1010","1100","2222","2222");
        var forest2 = new Array("0101","1111","0101","0011","1010","0100","0001","1010","0110","0101","1111","0101","2222","2222");
        var forest3 = new Array("0011","1010","0000","1000","1100","0001","0100","1001","1000","0000","1010","0110","2222","2222");
        var forest4 = new Array("1001","1010","0100","0101","0011","0010","0010","0110","0101","0001","1010","1100","2222","2222");
        var forest5 = new Array("0001","1100","0101","0101","1001","1100","1001","1100","0101","0101","1001","0100","2222","2222");
        var forest6 = new Array("0001","0100","0001","0010","0010","0100","0001","0010","0010","0100","0001","0100","2222","2222");
        var forest7 = new Array("0011","0010","0000","1100","1001","0000","0000","1100","1001","0000","0010","0110","2222","2222");
        var forest8 = new Array("1001","1010","0100","0101","0001","0010","0010","0100","0101","0001","1010","1100","2222","2222");
        var forest9 = new Array("0011","1010","0010","0000","0100","1111","1111","0001","0000","0010","1000","0000","1000","1100");
        var forest10 = new Array("1001","1010","1100","0011","0010","1000","1000","0010","0110","1001","0010","0100","0001","0100");
        var forest11 = new Array("0101","1111","0011","1000","1010","0010","0010","1010","1000","0110","1111","0101","0101","0101");
        var forest12 = new Array("0011","1010","1010","0010","1010","1010","1010","1010","0010","1010","1010","0000","0100","0101");
        var forest13 = new Array("2222","2222","2222","2222","2222","2222","2222","2222","2222","1001","1010","0010","0100","0101");
        var forest14 = new Array("2222","2222","2222","2222","2222","2222","2222","2222","2222","0011","1010","1010","0010","0110");
        nodes = [forest1,forest2,forest3,forest4,forest5,forest6,forest7,forest8,forest9,forest10,forest11,forest12,forest13,forest14];

        tileStat = new Array();
        for(var i=0;i<row_count;i++) {
            tileStat.push([]);
            for(var j=0;j<col_count;j++) {
                tileStat[i].push(1);
            }
        }

        my_loc = new Location(10, 8);

        bulldozers = [
            new Bulldozer(1200, new Location(0, 3), 1),
            new Bulldozer(910, new Location(0, 8), 1),
            new Bulldozer(840, new Location(5, 0), 2)
        ];
    }, function() {
        // LEVEL 3
        row_count = 14;
        col_count = 20;

        var forest1 = new Array("1001", "1010", "1100","1001","1010","1010","1010","1000","1000","1100","1001","1000","1000","1010","1010","1010","1100","1001","1010","1100");
        var forest2 = new Array("0101","1111","0101","0101","1001","1010","1000","0110","0101","0101","0101","0101","0011","1000","1010","1100","0101","0101","1111","0101");
        var forest3 = new Array("0011","1010","0100","0101","0011","1100","0011","1010","0100","0011","0110","0001","1010","0110","1001","0110","0101","0001","1010","0110");
        var forest4 = new Array("1001","1100","0011","0000","1000","0100","1001","1100","0001","1100","1001","0100","1001","1100","0001","1000","0000","0110","1001","1100");
        var forest5 = new Array("0101","0101","1001","0100","0011","0100","0101","0011","0000","0110","0011","0000","0110","0101","0001","0110","0001","1100","0101","0101");
        var forest6 = new Array("0101","0011","0100","0001","1100","0011","0000","1100","0001","1000","1000","0100","1001","0000","0110","1001","0100","0001","0110","0101");
        var forest7 = new Array("0001","1100","0101","0001","0110","1111","0001","0110","0001","0000","0000","0100","0011","0100","1111","0011","0100","0101","1001","0100");
        var forest8 = new Array("0101","0001","0010","0010","1010","1100","0011","1010","0010","0000","0000","0010","1010","0110","1001","1010","0010","0010","0100","0101");
        var forest9 = new Array("0011","0010","1010","1000","1010","0000","1000","1000","1010","0010","0010","1010","1000","1000","0000","1010","1000","1010","0010","0110");
        var forest10 = new Array("1001","1010","1010","0100","1001","0100","0011","0100","1001","1000","1000","1100","0001","0110","0001","1100","0001","1010","1010","1100");
        var forest11 = new Array("0101","1001","1010","0000","0000","0010","1000","0100","0011","0000","0000","0110","0001","1000","0010","0000","0000","1010","1100","0101");
        var forest12 = new Array("0001","0100","1111","0101","0001","1100","0011","0010","1000","0010","0010","1000","0010","0110","1001","0100","0101","1111","0011","0110");
        var forest13 = new Array("0101","0011","1010","0110","0001","0010","1010","1000","0000","1000","1000","0000","1000","1010","0010","0100","0101","1001","1010","1100");
        var forest14 = new Array("0011","1010","1010","1010","0010","1010","1010","0110","0011","0010","0010","0110","0011","1010","1010","0010","0110","0011","1010","0100");
        nodes = [forest1,forest2,forest3,forest4,forest5,forest6,forest7,forest8,forest9,forest10,forest11,forest12,forest13,forest14];

        tileStat = new Array();
        for(var i=0;i<row_count;i++) {
            tileStat.push([]);
            for(var j=0;j<col_count;j++) {
                tileStat[i].push(1);
            }
        }
        for(var i=12;i<=13;i++) {
            for(var j=17;j<=19;j++) {
                tileStat[i][j] = 4;
            }
        }

        my_loc = new Location(10, 6);

        bulldozers = [
            new Bulldozer(1190, new Location(0, 3), 1),
            new Bulldozer(910, new Location(11, 0), 2),
            new Bulldozer(830, new Location(19, 8), 3),
            new Bulldozer(720, new Location(11, 13), 0)
        ];
        humans = [
            new Human(1200, new Location(19, 13), 0)
        ];

    }, function() {
        // LEVEL 4
        row_count = 12;
        col_count = 12;

        var tiles1 = new Array("1001", "1010", "1100","1001","1010","1100","1001","1010","1100","1001","1010","1100");
        var tiles2 = new Array("0101","1111","0101","0011","1010","0100","0001","1010","0110","0101","1111","0101");
        var tiles3 = new Array("0011","1010","0000","1000","1100","0001","0100","1001","1000","0000","1010","0110");
        var tiles4 = new Array("1001","1010","0100","0101","0011","0010","0010","0110","0101","0101","1001","1100");
        var tiles5 = new Array("0001","1100","0101","0101","1001","1100","1001","1100","0101","0101","0101","0101");
        var tiles6 = new Array("0001","0100","0001","0010","0010","0000","0000","0010","0010","0100","0101","0101");
        var tiles7 = new Array("0011","0010","0000","1100","1001","0000","0000","1100","1001","0100","0101","0101");
        var tiles8 = new Array("1001","1010","0100","0101","0001","0010","0010","0100","0101","0101","0101","0101");
        var tiles9 = new Array("0011","1010","0010","0000","0100","1111","1111","0001","0010","0110","0101","0101");
        var tiles10 = new Array("1001","1010","1100","0011","0010","1010","1000","0110","1001","1010","0110","0101");
        var tiles11 = new Array("0101","1111","0011","1010","1010","1010","0010","1010","0100","1111","1111","0101");
        var tiles12 = new Array("0011","1010","1010","1010","1010","1010","1010","1010","0010","1010","1010","0110");

        nodes = [tiles1,tiles2,tiles3,tiles4,tiles5,tiles6,tiles7,tiles8,tiles9,tiles10,tiles11,tiles12];

        tileStat = new Array();
        for(i=0;i<row_count;i++) {
            tileStat.push([]);
            for(j=0;j<col_count;j++) {
                tileStat[i].push(4);
            }
        }
        for(i=0;i<9;i++) {
            for(j=0;j<10;j++) {
                tileStat[i][j]=1;
            }
        }
        for(i=3;i<8;i++) {
            tileStat[9][i]=1;
        }
        for(i=0;i<3;i++) {
            for(j=10;j<12;j++) {
                tileStat[i][j]=1;
            }
        }

        my_loc = new Location(3, 2);

        bulldozers = [
            new Bulldozer(1160, new Location(5, 9), 3),
            new Bulldozer(910, new Location(6, 9), 1),
        ];
        humans = [
            new Human(1200, new Location(1, 11), 1)
        ];
    }, function() {
        // LEVEL 5
        row_count = 14;
        col_count = 14;

        var forest1 = new Array("1001","1010","1010","1010","1010","1010","1010","1100","1001","1010","1000","1010","1010","1000","1000","1100","1111","1111","1001","1010","1000","1010","1100","1111","1111","1001","1100","1111");
        var forest2 = new Array("0101","1001","1000","1000","1010","1010","1010","0110","0101","1111","0011","1010","1010","0100","0001","0110","1111","1111","0011","1010","0010","1100","0101","1111","1111","0101","0101","1111");
        var forest3 = new Array("0101","0001","0000","0110","1001","1010","1010","1010","0100","1111","1111","1111","1111","0101","0101","1111","1111","1001","1000","1000","1010","0110","0101","1111","1111","0101","0101","1111");
        var forest4 = new Array("0001","0000","0110","1111","0101","1111","1111","1111","0101","1111","1001","1000","1010","0110","0101","1111","1111","0001","0010","0110","1001","1000","0110","1111","1111","0101","0101","1111");
        var forest5 = new Array("0001","0100","1111","1001","0100","1001","1010","1010","0010","1010","0100","0101","1111","1111","0101","1111","1111","0101","1111","1111","0101","0101","1001","1010","1010","0100","0101","1111");
        var forest6 = new Array("0001","0100","1111","0101","0011","0000","1010","1010","1010","1010","0010","0010","1000","1100","0101","1111","1111","0101","1111","1111","0101","0101","0101","1111","1111","0011","0100","1111");
        var forest7 = new Array("0001","0100","1111","0101","1111","0101","1111","1111","1111","1111","1001","1100","0011","0110","0101","1111","1111","0101","1111","1111","0101","0101","0101","1111","1111","1111","0001","1100");
        var forest8 = new Array("0001","0100","1111","0101","1111","0001","1010","1010","1010","1010","0100","0101","1111","1111","0101","1111","1111","0101","1111","1111","0101","0101","0101","1111","1111","1111","0101","0101");
        var forest9 = new Array("0101","0001","1100","0101","1111","0101","1111","1111","1111","1111","0011","0110","1001","1100","0101","1111","1111","0101","1111","1111","0101","0101","0101","1111","1111","1111","0101","0101");
        var forest10 = new Array("0101","0011","0110","0011","1010","0010","1010","1010","1000","1010","1010","1010","0110","0101","0101","1111","1111","0101","1111","1111","0101","0001","0010","1100","1111","1111","0101","0101");
        var forest11 = new Array("0001","1000","1100","1111","1111","1111","1111","1111","0001","1010","1010","1010","1010","0110","0001","1000","1010","0110","1111","1111","0011","0010","1010","0110","1111","1001","0100","0101");
        var forest12 = new Array("0001","0010","0110","1111","1111","1111","1111","1111","0011","1010","1010","1010","1010","1100","0101","0101","1001","1100","1001","1100","1111","1111","1111","1111","1001","0000","0100","0101");
        var forest13 = new Array("0001","1010","1010","1000","1010","1010","1010","1010","1000","1010","1010","1000","1010","0110","0101","0101","0001","0100","0011","0010","1000","1000","1000","1000","0000","0010","0110","0101");
        var forest14 = new Array("0011","1010","1010","0110","1111","1111","1111","1111","0011","1010","1010","0110","1111","1111","0011","0110","0011","0010","1010","1010","0010","0010","0010","0010","0010","1010","1010","0110");
        nodes = [forest1,forest2,forest3,forest4,forest5,forest6,forest7,forest8,forest9,forest10,forest11,forest12,forest13,forest14];

		page_count_x = 2;

        tileStat = new Array();
        for (i=0;i<row_count;i++) {
            tileStat.push([]);
            for(j=0;j<col_count*2;j++) {
                tileStat[i].push(4);
            }
        }
        for(i=0;i<2;i++) {
            for(j=0;j<8;j++) {
                tileStat[i][j]=1;
                tileStat[j+6][i+26]=1;
            }
        }
        for(i=2;i<3;i++) {
            for(j=0;j<4;j++) {
                tileStat[i][j]=1;
                tileStat[j+10][i+23]=1;
            }
        }
        for(i=3;i<4;i++) {
            for(j=0;j<3;j++) {
                tileStat[i][j]=1;
                tileStat[j+11][i+21]=1;
            }
        }
        for(i=4;i<12;i++) {
            for(j=0;j<2;j++) {
                tileStat[i][j]=1;
                tileStat[j+12][i+12]=1;
            }
        }
        for(i=8;i<12;i++) {
            for(j=2;j<3;j++) {
                tileStat[i][j]=1;
                tileStat[j+9][i+8]=1;
            }
        }

        my_loc = new Location(2, 2);

		bulldozers = [
            new Bulldozer(810, new Location(0, 11), 1),
            new Bulldozer(660, new Location(26, 6), 1),
		];

		humans = [
			new Human(1100, new Location(13, 5), 2),
			new Human(1120, new Location(10, 7), 1),
			new Human(1040, new Location(13, 8), 3),
			new Human(900, new Location(19, 2), 1),
			new Human(1200, new Location(15, 10), 2),
			new Human(850, new Location(23, 4), 3),
			new Human(1070, new Location(25, 4), 0)
		];

		$("#arrow").show();
    }
];



